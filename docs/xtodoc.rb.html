<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>xtodoc.rb</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dimage%3A%20none%20%21important%3B%0Abackground%2Dcolor%3A%20rgba%2840%2C%2042%2C%2054%2C%201%29%20%21important%3B%0A%7D%0Abody%20%2A%20%7B%0Acolor%3A%20rgba%28248%2C%20248%2C%20242%2C%201%29%3B%0A%7D%0Aa%2C%0Aa%20%2A%20%7B%0Acolor%3A%20rgba%2880%2C%20250%2C%20123%2C%201%29%20%21important%3B%0Abackground%2Dcolor%3A%20transparent%20%21important%3B%0A%7D%0Aa%3Ahover%2C%0Aa%3Ahover%20%2A%2C%0Aa%3Avisited%3Ahover%2C%0Aa%3Avisited%3Ahover%20%2A%2C%0Aspan%5Bonclick%5D%3Ahover%2C%0Adiv%5Bonclick%5D%3Ahover%2C%0A%5Brole%3D%22link%22%5D%3Ahover%2C%0A%5Brole%3D%22link%22%5D%3Ahover%20%2A%2C%0A%5Brole%3D%22button%22%5D%3Ahover%20%2A%2C%0A%5Brole%3D%22menuitem%22%5D%3Ahover%2C%0A%5Brole%3D%22menuitem%22%5D%3Ahover%20%2A%2C%0A%2Elink%3Ahover%2C%0A%2Elink%3Ahover%20%2A%20%7B%0Acolor%3A%20rgba%28241%2C%20250%2C%20140%2C%201%29%20%21important%3B%0A%7D%0Aa%3Avisited%2C%0Aa%3Avisited%20%2A%20%7B%0Acolor%3A%20rgba%2898%2C%20114%2C%20164%2C%201%29%20%21important%3B%0A%7D%0Ah1%2C%0Ah2%2C%0Ah3%2C%0Ah4%2C%0Ah5%2C%0Ah6%2C%0Astrong%2C%0A%5Bid%2A%3D%22headline%22%5D%2C%0A%5Bclass%2A%3D%22headline%22%5D%2C%0A%5Bid%2A%3D%22header%22%5D%2C%0A%5Bclass%2A%3D%22header%22%5D%2C%0A%5Bclass%2A%3D%22header%22%5D%20td%20%7B%0Acolor%3A%20rgba%28255%2C%20184%2C%20108%2C%201%29%20%21important%3B%0A%7D%0Atable%20%7B%0Abackground%2Dcolor%3A%20rgba%2840%2C%2042%2C%2054%2C%201%29%20%21important%3B%0A%7D%0A%5Bid%2A%3D%22overlay%22%5D%2C%0A%5Bid%2A%3D%22lightbox%22%5D%2C%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20rgba%2868%2C%2071%2C%2090%2C%201%29%20%21important%3B%0A%7D%0Ainput%2C%0Aselect%2C%0Abutton%2C%0A%5Brole%3D%22button%22%5D%2C%0Aa%2Ebutton%2C%0Aa%2Esubmit%2C%0Aa%2EBigButton%2C%0Aa%2ETabLink%2C%0A%2Einstall%5Bonclick%5D%20%7B%0Atext%2Dindent%3A%205px%3B%0Aappearance%3A%20none%20%21important%3B%0A%2Dmoz%2Dappearance%3A%20none%20%21important%3B%0A%2Dwebkit%2Dappearance%3A%20none%20%21important%3B%0Abackground%3A%20rgba%2868%2C%2071%2C%2090%2C%201%29%20%21important%3B%0A%7D%0Atextarea%20%7B%0Aappearance%3A%20none%20%21important%3B%0A%2Dmoz%2Dappearance%3A%20none%20%21important%3B%0A%2Dwebkit%2Dappearance%3A%20none%20%21important%3B%0Abackground%3A%20rgba%2868%2C%2071%2C%2090%2C%201%29%20%21important%3B%0A%7D%0Adiv%2C%0Aul%2C%0Ali%20%7B%0Abackground%2Dimage%3A%20none%20%21important%3B%0A%7D%0Aa%2Ehighlight%2C%0Aa%2Ehighlight%20%2A%2C%0Aa%2Eactive%2C%0Aa%2Eactive%20%2A%2C%0A%2Eselected%2C%0A%2Eselected%20%2A%2C%0A%5Bhref%3D%22%23%22%5D%20%7B%0Afont%2Dweight%3A%20bold%20%21important%3B%0Acolor%3A%20rgba%28139%2C%20233%2C%20253%2C%201%29%20%21important%3B%0A%7D%0Abody%20%7B%0Awidth%3A%2050%25%3B%0Amargin%2Dinline%3A%20auto%3B%0A%7D%0A%2EsourceCode%20%7B%0Aborder%2Dradius%3A%2010px%3B%0Apadding%3A%203px%3B%0A%7D%0A" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <nav class="nav">
          <div class="logo">
              <a href="/index.html" accesskey="h" title="wizardwatch (Alt + H)">wizardwatch</a>
              <span class="logo-switches">
              </span>
          </div>
          <ul id="menu">
              <li>
                  <a href="https://wizardwatch.net/tags/" title="Tags">
                      <span>Tags</span>
                  </a>
              </li>
          </ul>
      </nav>
</head>
<body>
<header id="title-block-header">
<h1 class="title">xtodoc.rb</h1>
</header>
<pre><code>require &quot;file_utils&quot;
def makeindex(output, dir)
  files = Dir[&quot;#{dir}/**&quot;]
  puts &quot;dir + #{dir}&quot;
  puts &quot;files + #{files}&quot;
  output.puts
  files.each do |file|
    if !File.directory?(file)
      output.puts(&quot;./[#{File.basename(file, File.extname(file))}](./#{File.basename(file, File.extname(file))}.html)&quot;)
    else
      output.puts(&quot;./[#{File.basename(file, File.extname(file))}](./#{File.basename(file, File.extname(file))}/index.html)&quot;)
    end
    output.puts
  end
end

def image?(file)
  file.to_s.includes?(&quot;.gif&quot;) || file.to_s.includes?(&quot;.png&quot;) || file.to_s.includes?(&quot;.jpg&quot;)
end


def begin_file(file, output_file)
  output_file.puts(&quot;---&quot;)
  output_file.puts(&quot;title: #{File.basename(file)}&quot;)
  output_file.puts(&quot;---&quot;)
end

def nix(file, output_file, file_extension)
  begin_file(file, output_file)
  code = true
  input_file = File.open(file)
  file_lines = input_file.read_line
  if file_lines.chomp == &quot;/*&quot;
    puts &quot;Found comment at beggining of file&quot; + file
  else
    puts file + &quot;Added extension at begin&quot;
    output_file.puts(&quot;```#{file_extension}&quot;)
  end
  input_file.each_line do |line|
    if line.chomp.lstrip.starts_with? &quot;/*&quot;
      code = false
      output_file.puts(&quot;```&quot;)
    elsif line.chomp.lstrip.starts_with? &quot;*/&quot;
      code = true
      output_file.puts(&quot;```#{file_extension}&quot;)
    else
      if code == true
        output_file.puts(line)
      else
        output_file.puts(line.lstrip)
      end
    end
  end
  output_file.puts(&quot;```&quot;)
  output_file.close
end

def md(file, output_file)
  begin_file(file, output_file)
  File.open(file).each_line do |line|
    output_file.puts(line)
  end
  output_file.close
end

def other(file, output_file)
  begin_file(file, output_file)
  output_file.puts(&quot;```&quot;)
  File.open(file).each_line do |line|
    output_file.puts(line)
  end
  output_file.puts(&quot;```&quot;)
  output_file.close
end

def mdfile(file, output_dir)
  case File.extname(file).delete(&quot;.&quot;)
  when &quot;nix&quot;
    nix(file, File.new(&quot;#{output_dir}/#{file}.md&quot;, &quot;w&quot;), &quot;nix&quot;)
  when &quot;md&quot;
    md(file, File.new(&quot;#{output_dir}/#{file}&quot;, &quot;w&quot;))
  else
    other(file, File.new(&quot;#{output_dir}/#{file}.md&quot;, &quot;w&quot;))
  end
end

# config = TOML::Parser.new(File.open(&quot;./xtodoc.toml&quot;).read).parsed
OUTPUT_DIR = &quot;docs/&quot;
`rm -rf #{OUTPUT_DIR}`
resource_paths = Dir.glob(&quot;**/*&quot;).reject do |path|
  File.directory?(path) || path.ends_with?(&quot;index.md&quot;) || image?(path)
end
images = Dir.glob(&quot;**/*&quot;).select do |path|
  image?(path)
end
directories = Dir.glob(&quot;**/*&quot;).select do |path|
  File.directory?(path) &amp; (path != OUTPUT_DIR)
end
# FileUtils.mkpath OUTPUT_DIR
`mkdir #{OUTPUT_DIR}`
directories.each do |dir|
  # FileUtils.mkpath &quot;#{OUTPUT_DIR}/#{dir}&quot;
  mkcommand = &quot;mkdir #{OUTPUT_DIR}/#{dir}&quot;
  `#{mkcommand}`
end
resource_paths.each do |file|
  mdfile(file, OUTPUT_DIR)
end
directories.each do |dir|
  index = File.new(&quot;#{OUTPUT_DIR}/#{dir}/index.md&quot;, &quot;w&quot;)
  begin_file(dir, index)
  if File.exists?(&quot;#{dir}/index.md&quot;)
    File.open(&quot;#{dir}/index.md&quot;).each_line do |output|
      index.puts(output)
    end
  end
  makeindex(index, &quot;#{OUTPUT_DIR}#{dir}&quot;)
  index.close
end
index = File.open(&quot;#{OUTPUT_DIR}/index.md&quot;, &quot;w&quot;)
begin_file(OUTPUT_DIR.to_s, index)
File.open(&quot;./index.md&quot;).each_line do |output|
  index.puts(output)
end
makeindex(index, OUTPUT_DIR.to_s)
images.each do |image|
  FileUtils.cp(image, &quot;./docs/#{image}&quot;)
end
index.close
resource_paths_html = Dir[&quot;./docs/**/*&quot;].reject do |path|
  File.directory?(path) || image?(path)
end

resource_paths_html.each do |file|
  output_file_path = file[0..-4]
  puts output_file_path
  command = &quot;pandoc -s #{file} -o #{output_file_path}.html --highlight-style=./theme/dracula/dracula.theme --css=./theme/wizardwatch.css --self-contained -H ./theme/header.html --lua-filter ./theme/root.lua&quot;
  `#{command}`
  `rm #{file}`
end</code></pre>
</body>
</html>
